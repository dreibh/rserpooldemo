#!/bin/sh
# $Id$
# ***************************************************************************
# *   The RSerPool Demo System                                              *
# *                                                                         *
# *   Author: Thomas Dreibholz, dreibh@exp-math.uni-essen.de                *
# *                                                                         *
# *   This program is free software; you can redistribute it and/or modify  *
# *   it under the terms of the GNU General Public License as published by  *
# *   the Free Software Foundation; either version 2 of the License, or     *
# *   (at your option) any later version.                                   *
# *                                                                         *
# *   This program is distributed in the hope that it will be useful,       *
# *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
# *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
# *   GNU General Public License for more details.                          *
# *                                                                         *
# *   You should have received a copy of the GNU General Public License     *
# *   along with this program; if not, write to the                         *
# *   Free Software Foundation, Inc.,                                       *
# *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
# ***************************************************************************

if [ $# -lt 1 ] ; then
   echo >&2 "Usage: LocalDemo.config [PR|PE|PU] {Arguments ...}"
   exit 1
fi

# IMPORTANT: All arguments of this script must be shifted away;
#            ComponentControl expects its own arguments only!
CC_COMPONENT=$1
shift


# ====== Base configuration =================================================
RSERPOOLDEMO_CSPOPT="-cspserver=127.0.0.1:2960 -cspinterval=250"
RSERPOOLDEMO_PRLIST=""
RSERPOOLDEMO_ASAP_UNICAST="[::]:0"
RSERPOOLDEMO_ASAP_ANNOUNCE="auto"
RSERPOOLDEMO_ENRP_UNICAST="[::]:0"
RSERPOOLDEMO_ENRP_MULTICAST="auto"


# ====== Set base directories and parameters ================================
if [ -e /home/dreibh/src ] ; then
   echo "x1"
   CC_BASEDIR="/home/dreibh/src"
elif [ -e /home/demo/src ] ; then
   CC_BASEDIR="/home/demo/src"
else
   CC_BASEDIR="$HOME/src"
   if [ ! -e $CC_BASEDIR ] ; then
      echo >&2 "ERROR: Base directory $CC_BASEDIR does not exist!"
   fi
fi

CC_PROGRAM_DIRECTORY="$CC_BASEDIR/rsplib2/rsplib"
CC_PID_DIRECTORY="$CC_BASEDIR/rserpooldemo/bin/output"
CC_OUTPUT_DIRECTORY="$CC_BASEDIR/rserpooldemo/bin/output"

RSERPOOLDEMO_PROPT=""
RSERPOOLDEMO_PEEROPT=""
for pr in "$RSERPOOLDEMO_PRLIST" ; do
   RSERPOOLDEMO_PROPT="$RSERPOOLDEMO_PROPT -registrar=$pr:3863"
   RSERPOOLDEMO_PEEROPT="$RSERPOOLDEMO_PEEROPT -peer=$pr:3864"
done


# ====== Pool Element Setup =================================================
if [ "x$CC_COMPONENT" = "xPE" ] ; then
   CC_PROGRAM="server"
   CC_LOGARGS="-logfile="   # The file name will be appended immediately!

   CC_ARGS="-loglevel=5 -logcolor=off \
   -fractal \
   -policy=RoundRobin \
   -poolhandle=FractalDemoPool \
   -rereginterval=5000 \
   -asapannounce=$RSERPOOLDEMO_ASAP_ANNOUNCE \
   $RSERPOOLDEMO_CSPOPT $RSERPOOLDEMO_PROPT"

# ====== Pool User Setup ====================================================
elif [ "x$CC_COMPONENT" = "xPU" ] ; then
   CC_PROGRAM="fractalpooluser"
   CC_LOGARGS="-logfile="   # The file name will be appended immediately!

   FGPCONFIGDIR="$CC_PROGRAM_DIRECTORY/fgpconfig"

   CC_ARGS="-loglevel=5 -logcolor=off \
   -configdir=$FGPCONFIGDIR \
   -poolhandle=FractalDemoPool \
   -asapannounce=$RSERPOOLDEMO_ASAP_ANNOUNCE \
   $RSERPOOLDEMO_CSPOPT $RSERPOOLDEMO_PROPT"


   if [ ! -e "$FGPCONFIGDIR" ] ; then
      echo >&2 "WARNING: Fractal configuration directory $FGPCONFIGDIR does not exist!"
      echo >&2 "         You will only get the default image!"
   fi

# ====== Registrar Setup ====================================================
elif [ "x$CC_COMPONENT" = "xPR" ] ; then
   CC_PROGRAM="registrar"
   CC_LOGARGS="-logfile="   # The file name will be appended immediately!

   CC_ARGS="-loglevel=5 -logcolor=off \
   -asap=$RSERPOOLDEMO_ASAP_UNICAST -asapannounce=$RSERPOOLDEMO_ASAP_ANNOUNCE \
   -enrp=$RSERPOOLDEMO_ENRP_UNICAST -enrpmulticast=$RSERPOOLDEMO_ENRP_MULTICAST \
   -maxbadpereports=99999999 \
   $RSERPOOLDEMO_CSPOPT $RSERPOOLDEMO_PEEROPT"

# ====== Bad setting ========================================================
else
   echo >&2 "ERROR: Bad component name!"
   exit 1
fi
