#!/bin/sh
# $Id$
# ***************************************************************************
# *   The RSerPool Demo System                                              *
# *                                                                         *
# *   Authors: Thomas Dreibholz, dreibh@exp-math.uni-essen.de               *
# *            Sebastian Rohde, rohde@exp-math.uni-essen.de                 *
# *                                                                         *
# *   This program is free software; you can redistribute it and/or modify  *
# *   it under the terms of the GNU General Public License as published by  *
# *   the Free Software Foundation; either version 2 of the License, or     *
# *   (at your option) any later version.                                   *
# *                                                                         *
# *   This program is distributed in the hope that it will be useful,       *
# *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
# *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
# *   GNU General Public License for more details.                          *
# *                                                                         *
# *   You should have received a copy of the GNU General Public License     *
# *   along with this program; if not, write to the                         *
# *   Free Software Foundation, Inc.,                                       *
# *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
# ***************************************************************************

BASEDIR=$2
COMMAND="server -fractal -logcolor=off -loglevel=6 -cspserver=$3 -cspinterval=200 -identifier=$4 -fgpfailureafter=$5 -rereginterval=5000 -poolhandle=FractalDemoPool"
LOGFILE=$BASEDIR/demo-pe$4.log
PIDFILE=$BASEDIR/demo-pe$4.pid
APPNAME="server"

case "$1" in
start)
   echo starting $APPNAME
   if test -f $PIDFILE ; then
      echo pid-File present!
      exit 0
   fi
   if test -f $LOGFILE ; then
         mv $LOGFILE $LOGFILE.old
   fi
   $BASEDIR/$COMMAND -logfile=$LOGFILE &
   echo $! > $PIDFILE
   if [ ! $? = 0 ] ; then
      echo "ERROR: $BASEDIR/$COMMAND failed!"
      exit 1
   fi
   ;;
stop)
   if test -f $PIDFILE ; then
      PID=`cat $PIDFILE`
      if ps -p $PID | grep $APPNAME   1> /dev/null 2> /dev/null ; then
         echo Killing $APPNAME, PID is $PID ...
         kill $6 $7 $PID
      fi
      rm $PIDFILE
   fi
   ;;
logfile)
   if test -f $LOGFILE ; then
       konsole -e less $LOGFILE
   fi
   ;;

restart)
   $0 stop
   $0 start
   ;;
*)
   echo "Usage: $0 {start|stop|restart}"
   ;;
esac